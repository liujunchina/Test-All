!function(e){"use strict";var t=Base.klass.create({elements:{"#j_controlBtn":"elBtn","#j_num_1":"elNum1","#j_num_2":"elNum2","#j_num_3":"elNum3","#j_resultWrap":"elResultWrap"},events:{"click #j_controlBtn":"lotteryEvent","click #j-clearList":"clearListEvent","click #j_layerBg":"closeLayerEvent"},debug:!0,params:{animateSpeed:100,singleHeight:145,data:null,winningCookieId:"winningId",isPlaying:!1,playFlag:"active"},consoleLog:function(e){this.debug&&console.log(e)},init:function(){this.params.data=this._parseData(),this.consoleLog(this.params.data),this.flush()},_parseData:function(){var e,t,n,i=[];if(USERDATA&&(e=String(USERDATA).split(";"),t=e.length,t>0))for(var a=0;t>a;a++)n=String(e[a]).split(","),i.push({id:n[0],name:n[1],department:n[2]});return i},flush:function(){},lotteryEvent:function(e){return e.preventDefault(),this.params.isPlaying?!1:void(this.elBtn.hasClass(this.params.playFlag)?this.endLottery():this.startLottery())},clearListEvent:function(){this.clearWinningedUser(),alert("清楚中奖纪录成功")},closeLayerEvent:function(){this.elResultWrap.fadeOut()},getWinningedUser:function(){return Base.cookie.getCookie(this.params.winningCookieId)},addWinningedUser:function(e){Base.cookie.setCookie({name:this.params.winningCookieId,value:(this.getWinningedUser()+","+e).replace(/^,*/,"")})},clearWinningedUser:function(){Base.cookie.setCookie({name:this.params.winningCookieId,value:""})},getRandomUser:function(e){function t(){var n=Math.floor(Math.random()*e);return this.consoleLog(n+"是中过奖"+(a.indexOf(i[n].id)>-1)),n=a.indexOf(i[n].id)>-1?t.call(this,e):n}var n,i=this.params.data,a=this.getWinningedUser();return e=e||i.length,a.split(",").length>=e?!1:(this.randomNum=n=t.call(this),i[n])},_animate:function(t,n){function i(){t.delay(n.delay).animate({top:s+"px"},l,n.easing,function(){n.isFree?(t.css({top:0}),n.delay=0,i()):n.endCall()})}function a(e){n.isFree=!1,"function"==typeof e&&(n.endCall=e)}n=e.extend({isFree:!0,singleSpeed:this.params.animateSpeed,easing:"linear",singleHeight:this.params.singleHeight,numberLength:10,delay:0,endCall:e.noop},n);var s=0-n.singleHeight*n.numberLength,l=+n.singleSpeed*n.numberLength;return i(),{start:i,end:a}},startAnimate:function(){this.animateNum1=this._animate(this.elNum1),this.animateNum2=this._animate(this.elNum2,{delay:200}),this.animateNum3=this._animate(this.elNum3,{delay:400})},fixRandomNum:function(e){return 10>e?"00"+e:100>e?"0"+e:e},endAnimate:function(){function e(){clearTimeout(a),a=setTimeout(function(){n["animateNum"+i].end(function(){n["elNum"+i].css({top:0}),n._animate(n["elNum"+i],{isFree:!1,numberLength:+String(t).charAt(i-1),endCall:function(){i--,0!=i?e():setTimeout(function(){n._showResult(),n.params.isPlaying=!1},l)}})})},s)}var t=this.fixRandomNum(this.randomNum),n=this,i=3,a=null,s=700,l=1e3;n.params.isPlaying=!0,e()},_showResult:function(){this.elResultWrap.find(".j_id").text(this.winUser.id),this.elResultWrap.find(".j_department").text(this.winUser.department),this.elResultWrap.find(".j_name").text(this.winUser.name),this.elResultWrap.fadeIn()},startLottery:function(){this.elBtn.addClass(this.params.playFlag),this.startAnimate()},endLottery:function(){var e;this.elBtn.removeClass(this.params.playFlag),this.winUser=e=this.getRandomUser(),0!=e?(this.consoleLog("当前中奖用户:"),this.consoleLog(e),this.addWinningedUser(e.id),this.endAnimate()):alert("所有人都中过奖了")}});e(function(){new t})}(jQuery);