!function(e){"use strict";var n=Base.klass.create({elements:{"#j_controlBtn":"elBtn","#j_num_1":"elNum1","#j_num_2":"elNum2","#j_num_3":"elNum3"},events:{"click #j_controlBtn":"lotteryEvent","click #j-clearList":"clearListEvent"},debug:!0,params:{animateSpeed:100,singleHeight:145,data:null,winningCookieId:"winningId",isPlaying:!1,playFlag:"active"},consoleLog:function(e){this.debug&&console.log(e)},init:function(){this.params.data=this._parseData(),this.consoleLog(this.params.data),this.flush()},_parseData:function(){var e,n,t,i=[];if(USERDATA&&(e=String(USERDATA).split(";"),n=e.length,n>0))for(var a=0;n>a;a++)t=String(e[a]).split(","),i.push({id:t[0],name:t[1],department:t[2]});return i},flush:function(){},lotteryEvent:function(e){return e.preventDefault(),this.params.isPlaying?!1:void(this.elBtn.hasClass(this.params.playFlag)?this.endLottery():this.strartLottery())},clearListEvent:function(){this.clearWinningedUser(),alert("清楚中奖纪录成功")},getWinningedUser:function(){return Base.cookie.getCookie(this.params.winningCookieId)},addWinningedUser:function(e){Base.cookie.setCookie({name:this.params.winningCookieId,value:(this.getWinningedUser()+","+e).replace(/^,*/,"")})},clearWinningedUser:function(){Base.cookie.setCookie({name:this.params.winningCookieId,value:""})},getRandomUser:function(e){function n(){var t=Math.floor(Math.random()*e);return this.consoleLog(t+"是中过奖"+(a.indexOf(i[t].id)>-1)),t=a.indexOf(i[t].id)>-1?n.call(this,e):t}var t,i=this.params.data,a=this.getWinningedUser();return e=e||i.length,t=n.call(this),i[t]},_aniamte:function(n,t){function i(){n.delay(t.delay).animate({top:a+"px"},s,t.easing,function(){t.isFree&&(n.css({top:0}),t.delay=0,i())})}t=e.extend({isFree:!0,singleSpeed:this.params.animateSpeed,easing:"linear",singleHeight:this.params.singleHeight,numberLength:10,delay:0},t);var a=0-t.singleHeight*t.numberLength,s=+t.singleSpeed*t.numberLength;i()},startAniamte:function(){this._aniamte(this.elNum1),this._aniamte(this.elNum2,{delay:200}),this._aniamte(this.elNum3,{delay:400})},endAnimate:function(){},strartLottery:function(){this.elBtn.addClass(this.params.playFlag),this.startAniamte()},endLottery:function(){this.elBtn.removeClass(this.params.playFlag);var e=this.getRandomUser();e&&(this.consoleLog("当前中奖用户:"),this.consoleLog(e),this.consoleLog("\n"),this.addWinningedUser(e.id))}});e(function(){new n})}(jQuery);