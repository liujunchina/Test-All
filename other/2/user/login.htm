<!DOCTYPE html>
<html lang="en">
<head>
	{include file='top.htm'}

	<link rel="stylesheet" href="/temp/skin1/dist/mincss/login_min.css">
</head>
<body>
	<header id="header">
		{include file='user/public_sign_top.htm'}
	</header>
	
	<!-- 登录主体start -->
	<div class="login-main-wrap">
		<div class="js_loginPage public-login-page login-page w1200">
			<div class="left-pic"><a href="/m-users-a-join.htm"><img src="/temp/skin1/dist/images/domeimg/lazyload1.gif" width="535" height="436" data-original="/temp/skin1/dist/images/domeimg/login/login_left_2.png" alt=""></a></div>

			<div class="public-login-bord login-bord" id="js_loginBord">
				<form id="js_loginForm" action="#" method="post" autocomplete="off">
					<div class="public-tit mb25 clearfix">
						<span class="fl tit">账号登录</span>
                        <span class="fr js_switchLogin switch-login"><i class="login_icon icon_phone"></i>手机动态密码登录</span>
					</div>

					<div class="input-group mb25">
						<i class="login_icon icon_name position-left"></i>
						<div class="input-wrap">
							<input type="text" name="phone" maxlength="11" id="js_loginPhone" class="phone" placeholder="请输入手机号" >
						</div>
					</div>

					<div class="input-group mb25">
						<i class="login_icon icon_password position-left"></i>
						<div class="input-wrap">
							<input type="password" name="password" id="js_loginPassword" class="password" placeholder="请输入密码" >
						</div>
					</div>
					{if $repeat==1}
					<div class="input-group message-group mb25">
                        <input type="hidden" name="repeat" value="1" id="js_repeatNum"/>
						<div class="message-wrap clearfix">
							<div class="message fl">
								<input type="text" name="verifycode" class="verifycode js_verifycode" placeholder="输入验证码">
							</div>
							<div class="img-wrap fl"><img class="js_refreshVerifycode" data-src="/fun/?act=verify" src="/fun/?act=verify" width="100" height="40"></div>
						</div>
					</div>
					{/if}
					<p class="btn-wrapper mb25 clearfix">
						<span class="fl"><label for="js_agreeUserterm"><input type="checkbox" name="agree-userterm"  checked="checked" class="agree-userterm isagree" id="js_agreeUserterm">&nbsp;&nbsp;两周内自动登录</label></span>
						<a href="/m-users-a-get_password.htm" class="forget-password fr">忘记密码？</a>
					</p>

					<p class="submit mb30"><input type="hidden" name="ref" value="{$ref}" id="js_refValue" /><input type="submit" value="登录" id="js_submitLoginForm"/></p>
                    <p class="other-sign-method">
                        <span class="fr is-not-have">还没有账号？<a href="/m-users-a-join.htm">30秒注册</a></span>
                    </p>
					{* 取消微信登录 2015-08-06
                    <p class="other-sign-method"><a href="/m-users-a-wxqr.html"><i class="login_icon icon_weixin"></i>&nbsp;&nbsp;微信登录</a></p>
                    *}
				</form>

                <form id="js_loginSmsForm" class="none" action="/m-users-a-act_sign_sms.htm" method="post" autocomplete="off">
                    <div class="public-tit mb25 clearfix">
                        <span class="fl tit">动态密码登录</span>
                        <span class="fr js_switchLogin switch-login color_main">帐号密码登录</span>
                    </div>

                    <div class="input-group mb25">
                        <i class="login_icon icon_name position-left"></i>
                        <div class="input-wrap">
                            <input type="text" name="phone" maxlength="11" id="js_regPhone" data-type="4" class="phone" placeholder="请输入手机号">
                        </div>
                        <span class="position-right"><strong class="color_main f14">*</strong></span>
                    </div>

                    <div class="input-group message-group mb25" id="js_enterVerifycode">
                        <div class="message-wrap clearfix">
                            <div class="message fl">
                                <input maxlength="4" type="text" name="verifycode" id="js_accessCode" class="verifycode" placeholder="输入验证码">
                            </div>
                            <div class="img-wrap fl"><img class="js_refreshVerifycode" data-src="/fun/?act=verify" src="/fun/?act=verify" width="100" height="40"></div>
                        </div>
                        <span class="position-right"><strong class="color_main f14">*</strong></span>
                    </div>

                    <div class="input-group message-group mb25">
                        <div class="message-wrap clearfix">
                            <div class="message fl">
                                <input maxlength="6" type="text" name="phoneCode" id="js_regPhoneCode" class="phoneCode" placeholder="短信验证码">
                            </div>
                            <button id="js_smsCode" type="button" class="smscode no-click fr" disabled="disabled">获取短信验证码</button>
                        </div>
                        <span class="position-right"><strong class="color_main f14">*</strong></span>
                    </div>
                    <p class="submit"><input type="submit" value="登录" /></p>
                </form>
			</div><!-- .login-bord -->

		</div><!-- .login-page -->
		
	</div><!-- .login-main-wrap -->

	<footer id="footer">
		{include file='foot_c_js.htm'}
		{include file='user/public_sign_foot.htm'}
	</footer><!--end #footer -->
{literal}
	<script>
		$LAB.script("jquery.validate.min.js")
			.wait()
			.script("login.min.js?2015081301")
			.wait(function(){
				//填写登录信息
				(function(){
					var $js_loginForm = $("#js_loginForm");
                    var $js_loginSmsForm = $("#js_loginSmsForm");
                    var loginvalidate,loginSmsValidate;

                    $("#js_agreeUserterm").change(function(){
                        var $this = $(this);

                        if($this.hasClass('isagree')){
                            $this.removeClass('isagree').attr("checked",false);
                        }else{
                            $this.addClass('isagree').attr("checked",true);
                        }
                    });

					if($js_loginForm.length > 0){
						// 电话
						$.validator.addMethod("mobile", function(value, element) {
				                var length = value.length;
				                var mobile =  /^(((13[0-9]{1})|(15[0-9]{1})|(17[6-8]{1})|(14[5-7]{1})|(18[0-9]{1}))+\d{8})$/;
				                return this.optional(element) || (length == 11 && mobile.test(value));
				        }, "手机号码格式错误");

                        loginvalidate = $js_loginForm.validate({
							rules: {
								phone: {
									required: true,
									maxlength: 11,
									mobile:true 
								},
								verifycode: {
									required: true,
									minlength: 4,
									maxlength: 4
								},
							    password: {
							        required: true,
							        maxlength: 60,
							        minlength: 6
							    }
							},
							messages: {
								phone: {
									required: '请输入大陆地区手机号码',
									maxlength: '手机号码长度不能超过11位',
									mobile:'请输入正确的手机格式'
								},
								verifycode: {
									required: '请输入验证码',
									minlength: '验证码长度不对',
									maxlength: '验证码长度不对'
								},
							    password: {
							        required:  '请输入密码',
							        minlength: '密码长度必须大于6个字符'
							    }
							},
						   
							errorPlacement:function(error,element){
							    element.parent().find("label.checked").remove();
							    error.appendTo(element.parent());
						    },
                            submitHandler:function(form){

                                var phone = $("#js_loginPhone").val(),
                                    password = $("#js_loginPassword").val(),
                                    repeatNum = $("#js_repeatNum").length > 0 ? 1 : 0 ,
                                    verifycode = repeatNum > 0 ? $(".js_verifycode").val() : 0,
                                    ref = $("#js_refValue").val(),
                                    agree_userterm = $("#js_agreeUserterm").hasClass('isagree') ? 1 : 0 ;

                                $.ajax({
                                    url: '/m-users-a-act_sign.htm',
                                    type: 'POST',
                                    dataType: 'json',
                                    data: {phone:phone, password:password, agree_userterm:agree_userterm, verifycode:verifycode, ref:ref},
                                })
                                .done(function(data) {
                                    var status = data.status,
                                        msg = data.msg,
                                        url = data.url;

                                    if(status === 1){
                                        layer.open({
                                            btn: ['ok'],
                                            content: msg,
                                            end:function(){
                                                window.location.href = window.location.href;
                                            }
                                        })
                                    }else{
                                        if(url && url.length > 0){
                                            window.location.href = url;
                                        }
                                    }
                                });
                                
                            } ,
							success: function(label) {
							    label.remove();
							}
					    });

                        loginSmsValidate = $js_loginSmsForm.validate({
                            rules: {
                                phone: {
                                    required: true,
                                    maxlength: 11,
                                    mobile:true
                                },
                                verifycode: {
                                    required: true,
                                    minlength: 4,
                                    maxlength: 4
                                },
                                phoneCode: {
                                    required: true
                                },
                                password: {
                                    required: true,
                                    maxlength: 60,
                                    minlength: 6
                                },
                                password_confirm: {
                                    required: true,
                                    minlength: 6,
                                    maxlength: 60,
                                    equalTo: $("#js_regPassword")
                                },
                                email:{
                                    email:true
                                },
                                isagree: {
                                    required: true
                                }
                            },
                            messages: {
                                phone: {
                                    required: '请输入大陆地区手机号码',
                                    maxlength: '手机号码长度不能超过11位',
                                    mobile: '请输入正确的手机格式'
                                },
                                verifycode: {
                                    required: '请输入验证码',
                                    minlength: '验证码长度不对',
                                    maxlength: '验证码长度不对'
                                },
                                phoneCode: {
                                    required: '请输入正确的手机验证码'
                                },
                                password: {
                                    required:  '请设置密码',
                                    minlength: '密码长度必须大于6个字符'
                                },
                                password_confirm: {
                                    required:  '请再次确认密码',
                                    minlength: '密码长度必须大于6个字符',
                                    equalTo:   '两次密码输入不一致'
                                },
                                email:{
                                    email:'请输入正确格式的电子邮件'
                                },
                                isagree: {
                                    required: '您未阅读并接受五洲会海购服务条款'
                                }
                            },

                            errorPlacement:function(error,element){
                                element.parent().find("label.checked").remove();
                                error.appendTo(element.parent());
                            },
                            success: function(label) {
                                label.remove();
                            }
                        });

                        $(".js_switchLogin").on("click", function () {
                            $js_loginForm.toggle();
                            $js_loginSmsForm.toggle();
                            $(".js_loginPage").toggleClass("login-sms-page");
                            loginvalidate.resetForm();
                            loginSmsValidate.resetForm();
                        });
                    }
				})();
			})	
	</script>
{/literal}


    <!-- 第三方统计代码 -->
    <div style="display:none;">
    <!--官网统计代码-->
    {literal}
    <script type="text/javascript">
        $(function () {
            setTimeout(function(){
                $LAB.script("//hm.baidu.com/hm.js?0fee07bdf074af72912949b59552450d");
             /*
             var _hmt = _hmt || [];
             (function() {
               var hm = document.createElement("script");
               hm.src = "//hm.baidu.com/hm.js?0fee07bdf074af72912949b59552450d";
               var s = document.getElementsByTagName("script")[0]; 
               s.parentNode.insertBefore(hm, s);
             })();
            */
            },300);
        });
    </script>
    {/literal}
    </div>

</body>
</html>