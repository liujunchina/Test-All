!function(e){e.fn.fileupload=function(i){var l=this;i=e.extend({},{maxFiles:2,parentSelector:".js_fileWarp",fileUploadDoneCall:e.noop,fileUploadDoneBeforeCall:e.noop,isUploadAvatar:!1,url:"http://www.wzhouhui.egocdn.com/temp/skin1/html/uploadFile/index.php",dataType:"json",maxFileSize:5242880,autoUpload:!0,acceptFileTypes:/(\.|\/)(gif|jpe?g|png|bmp)$/i},i);var a=function(e){e.find(".error").hide()},o=function(e,i){e.find(".error").html('<span class="form-error" style="display: inline;">'+i+"</span>").show()},n=function(l,a,o){var n="";i.isUploadAvatar?(e.each(a,function(e,i){n+='<li><img id="clipBigImg" src="'+i.url+'" alt="'+i.name+'"/><input type="hidden" name="avatar" value="'+i.url+'"/></li>'}),l.find(".js_files").html(n)):("undefined"==typeof o?e.each(a,function(e,i){n+='<li><i class="user-icon icon-remove js_remove remove" data-delete-url = '+i.deleteUrl+'></i><img src="'+i.url+'" alt="'+i.name+'"/><input type="hidden" name="file[]" value="'+i.url+'"/></li>'}):e.each(a,function(e,i){n+='<li><i class="user-icon icon-remove js_remove remove" data-delete-url = '+i.deleteUrl+'></i><img src="'+i.url+'" alt="'+i.name+'"/><input type="hidden" name="file['+o+'][]" value="'+i.url+'"/></li>'}),l.find(".js_files").append(n))};$LAB.script("jQuery-File-Upload/js/vendor/jquery.ui.widget.js").script("jQuery-File-Upload/js/jquery.iframe-transport.js").script("jQuery-File-Upload/js/jquery.fileupload.js").script("jQuery-File-Upload/js/jquery.fileupload-process.js").script("jQuery-File-Upload/js/jquery.fileupload-validate.js").wait(function(){l.each(function(){var l=e(this).closest(i.parentSelector),r=e(this).closest(".file-upload-warp"),t=e(this).data("id");l.on("click",".js_remove",function(){a(l),USER.userAjax.getAjaxPromise({url:e(this).data("delete-url"),type:"GET",global:!1},!1),e(this).parent("li").fadeOut(300,function(){e(this).remove(),r.show()})}),e(this).fileupload(i).on("fileuploadchange",function(e,n){a(l);var t=n.files.length+l.find(".js_files").children("li").length;return t>i.maxFiles?(o(l,"最多只能上传 "+i.maxFiles+" 张图片，请先删除"),!1):void(t==i.maxFiles&&r.hide())}).on("fileuploadadd",function(){}).on("fileuploadprocessalways",function(e,i){var a=i.index,n=i.files[a];n.error&&(r.show(),o(l,n.error))}).on("fileuploadprogressall",function(e,i){var a=parseInt(i.loaded/i.total*100,10);l.find(".progress-bar").css("width",a+"%")}).on("fileuploaddone",function(e,a){i.fileUploadDoneBeforeCall(),n(l,a.result.files,t),i.fileUploadDoneCall()}).on("fileuploadfail",function(){l.find(".progress").fadeOut(),o(l,"图片上传失败，请重试")}).on("fileuploadstart",function(){l.find(".progress").fadeIn()}).on("fileuploadstop",function(){l.find(".progress").fadeOut()}).prop("disabled",!e.support.fileInput).parent().addClass(e.support.fileInput?void 0:"disabled")})})}}(jQuery,window);