!function(e,r,a){r.USER={allAjaxUrl:{commissionToCashUrl:"/m-users-a-take_cash.htm",changePasswordUrl:"/m-users-a-do_change_password.htm",removeOrderUrl:"/m-users-a-cancel_order.htm",buyAgainUrl:"/m-flow-a-add_to_cart.html",shippingViewUrl:"/m-users-a-shipping.htm",shippingViewMoreUrl:"/m-users-a-shippingbylogis.htm",confirmReceipt:"/m-users-a-order_confirm_json.html",shippingAddressdeleteUrl:"/m-users-a-drop_consignee.htm",shippingAddressSetDefaultUrl:"/m-users-a-set_user_address.htm",shippingAddressVerifiedUrl:"/m-users-a-verified_cardid.htm",applyListUrl:"/m-users-a-apply_list.htm",cartUrl:"/m-flow-a-cart.html",loginUrl:"/m-users-a-sign.html"},userAjax:{getAjaxPromise:function(r,a){a=arguments.length>1?a:!0;var t={type:"POST",global:!0,dataType:"json"};r=e.extend({},t,r);var n=e.ajax(r);return a&&this.ajaxSuccessCall(n),n},ajaxSuccessCall:function(e){var r=this;e.done(function(e){0!=e.status&&r.ajaxSuccessFailCall(e)})},ajaxSuccessFailCall:function(e){var r=e.msg;USER.otherGlobal.layerAlertReload(r)}},commissionForm:{form:"",validate:function(){e.validator.setDefaults({debug:!1,success:"valid",ignore:""}),this.form.validate({errorClass:"form-error",wrapper:"p",success:function(e){e.remove()},errorPlacement:function(e,r){r.parent().parent().find(".error").remove(),e.addClass("error").appendTo(r.parent().parent())},rules:{username:{required:!0,rangelength:[2,10]},bank:{required:!0},"bank-num":{required:!0,digits:!0},"bank-name":{required:!0,rangelength:[5,50]},money:{required:!0,number:!0}},messages:{username:{required:"请输入名字",rangelength:"姓名格式错误"},bank:{required:"请选择银行"},"bank-num":{required:"请输入银行卡号",digits:"请输入正确的银行卡号"},"bank-name":{required:"请输入开户行",rangelength:"长度不符号"},money:{required:"请输入提现金额",digits:"请输入正确的提现金额"}}})},checkForm:function(t){var n=this;n.form=e("#"+t),a.script("jquery.validate.min.js").wait(function(){n.validate(),e(".js_toCash").on("click",function(){n.form.valid()&&USER.userAjax.getAjaxPromise({url:USER.allAjaxUrl.commissionToCashUrl,data:n.form.serialize()},!0).done(function(a){0==a.status&&USER.otherGlobal.openPop({end:function(){r.location.href=e("#js_pop").find(".js_getUrl").attr("href")}})}).fail(function(){USER.otherGlobal.layerAlertReload("佣金提现失败，点击确定重试！")})})})}},saleApplyForm:{form:"",validate:function(){var r=this;e.validator.setDefaults({debug:!1,success:"valid",ignore:"hidden"}),this.form.validate({errorClass:"form-error",wrapper:"p",success:function(e){e.remove()},errorPlacement:function(e,r){r.parent().parent().find(".error").remove(),e.addClass("error").appendTo(r.parent().parent())},rules:{status:{required:!0},reason:{required:!0},money:{required:!0,number:!0,min:0},message:{required:!0},num:{number:!0,min:1,max:r.form.find(".js_numBox").data("max")}},messages:{status:{required:"请选择货物状态"},reason:{required:"请选择退款原因"},money:{required:"请输入退款金额",number:"请输入正确的退款金额",min:"请输入正确的退款金额"},message:{required:"请输入退款说明"},num:{number:"请输入正确的退款数量",min:"请输入正确的退款数量",max:"请输入数量少于 {0}"}}})},bindNumModifiedEvent:function(){var r=this,a=r.form.find(".js_numBox");a.length<=0||(1==a[0].value&&r.form.find(".js_modifiedBox").addClass("disabled"),this.form.find(".js_modifiedBox").on("click",function(){if(e(this).hasClass("disabled"))return!1;var t,n=a.val()||1;r.form.find(".js_modifiedBox").removeClass("disabled"),e(this).hasClass("js_minusBox")?(t=--n,1==n&&r.form.find(".js_minusBox").addClass("disabled")):(t=++n>=a.data("max")?a.data("max"):n,n==a.data("max")&&r.form.find(".js_plusBox").addClass("disabled")),a[0].value=t}))},checkForm:function(r){var t=this;t.form=e("#"+r),t.bindNumModifiedEvent(),a.script("jquery.validate.min.js").wait(function(){t.validate(),t.form.find(".js_submit").on("click",function(e){e.preventDefault(),t.form.valid()&&t.form[0].submit()})})}},applyDetail:{undoFormId:"",form:"",validate:function(){e.validator.setDefaults({debug:!1,success:"valid",ignore:""}),this.form.validate({errorClass:"form-error",wrapper:"p",success:function(e){e.remove()},errorPlacement:function(e,r){r.parent().parent().find(".error").remove(),e.addClass("error").appendTo(r.parent().parent())},rules:{cencel:{required:!0}},messages:{cencel:{required:"请选择撤销原因"}}})},checkUndoForm:function(){var r=this;r.form=e("#"+this.undoFormId),a.script("jquery.validate.min.js").wait(function(){r.validate(),e(".js_submit").on("click",function(){r.form.valid()&&USER.userAjax.getAjaxPromise({url:r.form.attr("action"),type:"GET",data:r.form.serialize()},!0).done(function(e){0==e.status&&USER.otherGlobal.layerAlertReload("撤销成功",USER.allAjaxUrl.applyListUrl)}).fail(function(){USER.otherGlobal.layerAlertReload("撤销失败",USER.allAjaxUrl.applyListUrl)})})})},imgEvent:function(){e(".js_saleDetail").on("click",".img",function(r){r.preventDefault(),e(this).addClass("zoom"),e(this).siblings(".zoom").removeClass("zoom").find("img").stop().width(80).height(80/.75);var a=e(this).width();a=80==a?200:80,e(this).find("img").stop().animate({width:a+"px",height:a/.75+"px"},500)})},detailInit:function(r){this.undoFormId=r,this.checkUndoForm(),this.imgEvent(),e(".js_undo").on("click",function(e){e.preventDefault(),USER.otherGlobal.openPop({title:"撤消售后申请",area:["500px","330px"]},!0)})}},reviewForm:{form:"",validate:function(){USER.otherGlobal.setValidateCnMessage(),e.validator.setDefaults({debug:!1,success:"valid",ignore:""}),this.form.validate({meta:"validate",errorClass:"form-error",wrapper:"p",success:function(e){e.remove()},errorPlacement:function(e,r){r.parent().parent().find(".error").remove(),e.addClass("error").appendTo(r.parent().parent())},rules:{},messages:{}})},setStart:function(e,r){var a=e.siblings(".js_inputStart")[0],t=20;e.removeClass("start_"+a.value/t).addClass("start_"+r),a.value=r*t},bindEvent:function(){var r=this,a=25,t=null;r.form.find(".js_start").click(function(t){var n=e(this).offset().left,i=t.pageX-n,o=Math.ceil(i/a);r.setStart(e(this),o),e(this).hasClass("js_parentStart")&&r.form.find(".js_childStart").each(function(){r.setStart(e(this),o)})}),r.form.find(".js_parent").keyup(function(){var e=this.value;clearTimeout(t),t=setTimeout(function(){r.form.find(".js_child").text(e)},200)})},checkForm:function(r){var t=this;t.form=e("#"+r),t.bindEvent(),a.script("jquery.validate.min.js").wait(function(){t.validate(),e(".js_submit").on("click",function(){t.form.valid()&&t.form[0].submit()})})}},order:{cancelOrderFormValidate:function(e){var r=this;a.script("jquery.validate.min.js").wait(function(){r.cancelOrderFormValidateObj=USER.otherGlobal.getMyValidate(e,{rules:{cencel:{required:!0}},messages:{cencel:{required:"请选择取消原因"}}}),e.find(".js_submit").on("click",function(){e.valid()&&USER.userAjax.getAjaxPromise({url:USER.allAjaxUrl.removeOrderUrl,type:"GET",data:e.serialize()},!0).done(function(e){0==e.status&&USER.otherGlobal.layerAlertReload("取消成功")}).fail(function(){USER.otherGlobal.layerAlertReload("取消失败")})})})},createCancelOrderForm:function(){var r=e("<form />");return r.attr({"class":"user-global-form cancel-order-form none"}).html('<input type="hidden" name="is_auto" value="0"/><input type="hidden" name="order_sn" class="js_orderSn" value=""/><label><span class="form-label"><span class="required">*</span>取消原因</span><span class="reason-wrap"><select name="cencel"><option value="">请选择取消原因</option><option value="我不想买了">我不想买了</option><option value="信息填写错误，重新拍">信息填写错误，重新拍</option><option value="付款遇到困难">付款遇到困难</option><option value="4">拍错了</option><option value="重复下单">重复下单</option><option value="忘记使用优惠券">忘记使用优惠券</option><option value="其他原因">其他原因</option></select></span></label><p class="label-right mt20"><a class="btn btn-default js_submit" href="javascript:;" onclick="return false;">确定</a><a class="btn btn-outline js_cancel ml30" href="javascript:;" onclick="return false;">取消</a></p>'),r.appendTo("body"),this.cancelOrderFormValidate(r),r},getCancelOrderForm:function(){return"undefined"==typeof this.cancelOrderForm&&(this.cancelOrderForm=this.createCancelOrderForm()),this.cancelOrderForm.find(".js_orderSn").val(this.orderSn),this.cancelOrderForm},remove:function(e,r){if(e)if(this.orderSn=e,r)USER.userAjax.getAjaxPromise({url:USER.allAjaxUrl.removeOrderUrl,type:"GET",data:{order_sn:this.orderSn,is_auto:1,cencel:"订单超时，系统自动处理为取消订单！"},global:!1},!1);else{var a=this;USER.otherGlobal.openPop({title:"取消订单",content:this.getCancelOrderForm(),area:["500px","240px"],end:function(){USER.otherGlobal.resetForm(a.cancelOrderForm[0],a.cancelOrderFormValidateObj)}},!0)}},buyAgain:function(e){e&&USER.userAjax.getAjaxPromise({url:USER.allAjaxUrl.buyAgainUrl,data:{order_sn:e},type:"POST"},!0).done(function(e){0==e.status&&(r.location.href=USER.allAjaxUrl.cartUrl)}).fail(function(){USER.otherGlobal.layerAlertReload("再次购买失败")})},expirationTime:function(r,a,t){var n=this,i=e(r),o=GLOBAL.otherGlobal.getTime(a);return 0==o?(i.parent().html('<span class="color-increase color_increase">订单已过期，被自动取消</span>'),n.remove(t,!0),!1):(i.html(' <span class="color-increase">'+o.hours+'</span> 小时 <span class="color-increase">'+o.minutes+'</span> 分 <span class="color-increase">'+o.seconds+"</span> 秒"),a--,void setTimeout(function(){USER.order.expirationTime(r,a,t)},1e3))},shippingView:function(r,a,t){var n,i;void 0==r?(n=USER.allAjaxUrl.shippingViewMoreUrl,i={shipping_name:a,shipping_no:t}):(n=USER.allAjaxUrl.shippingViewUrl,i={order_sn:r}),USER.userAjax.getAjaxPromise({url:n,type:"POST",data:i},!0).done(function(r){if(0==r.status){if(void 0==r.msg||""==r.msg)return layer.alert("物流单号有误，请联系客服！"),!1;layer.open({type:2,title:'物流信息 <span style="padding-left: 10px;font-size: 14px;">'+r.shipping+"</span>",shadeClose:!1,shade:.8,area:["550px","400px"],content:r.msg,success:function(r){var a=e("<div />").css({display:"block",position:"absolute",width:"476px",height:"65px",backgroundColor:"#FFF",bottom:"22px",left:"35px",zIndex:"99"});e(r).find(".layui-layer-content").append(a)}})}}).fail(function(){USER.otherGlobal.layerAlertReload("获取数据失败，刷新重试")})},confirmReceipt:function(e){USER.userAjax.getAjaxPromise({url:USER.allAjaxUrl.confirmReceipt,type:"POST",data:{order_id:e}},!0).done(function(e){0==e.status&&USER.otherGlobal.windowReload()})}},coupon:{getCoupon:function(){var r=e(this).attr("href");USER.userAjax.getAjaxPromise({url:r,type:"GET"},!0).done(function(e){0==e.status&&USER.otherGlobal.openPop({title:"提示",area:["500px","300px"],end:function(){USER.otherGlobal.windowReload()}},!1)})},exchangeCoupon:function(r){r.preventDefault();var a=e("#exchange-coupon-form");""==a.find(".coupon-input").val()?layer.alert("请输入兑换码"):USER.userAjax.getAjaxPromise({url:a.attr("action"),data:a.serialize()},!0).done(function(e){0==e.status&&USER.otherGlobal.layerAlertReload("恭喜你兑换成功")}).fail(function(){USER.otherGlobal.layerAlertReload("兑换失败")})}},shippingAddrssManage:{parent:"",editClass:"js_edit",editFormId:"delivery_address_form",verifiedFormId:"verified-form",isEdit:function(){e("."+this.editClass).length>0&&e("html,body").scrollTop(e("#"+this.editFormId).offset().top)},init:function(r){var a=this;this.parent=r,this.verifiedForm(),this.isEdit(),r.on("click",".js_delete",function(r){r.preventDefault(),a.deleteAddress(e(this)[0],r)}),r.on("click",".js_verified",function(r){r.preventDefault(),a.verified(e(this)[0],r)}),r.on("click",".js_setDefault",function(r){r.preventDefault(),a.setDefault(e(this)[0],r)})},deleteAddress:function(a){var t=this;layer.confirm("确定该条删除地址 ？",{btn:["确认","取消"],shade:.3},function(){t.operate({url:USER.allAjaxUrl.shippingAddressdeleteUrl,data:{address_id:e(a).data("address-id")}}).done(function(e){0==e.status&&(r.location.href="/m-users-a-user_address.htm")})},function(){})},verified:function(r){var a=e("#js_pop");a.find(".js_name").text(e(r).data("username")),a.find(".js_cardId").text(e(r).data("cart-id")),a.find(".js_cardId2").val(e(r).data("cart-id")),a.find(".js_addressId").val(e(r).data("address-id")),USER.otherGlobal.openPop({title:"实名认证",area:["520px","420px"],end:function(){a.find(".js_remove").each(function(){USER.userAjax.getAjaxPromise({url:e(this).data("delete-url"),type:"GET",global:!1},!1)}),a.find(".js_files").empty(),a.find(".error").hide(),a.find(".js_files").data("end-clear",1)}},!0)},setDefault:function(r){var a=e(r).hasClass("selected");this.parent.find(".js_setDefault").filter(".selected").removeClass("selected"),e(r).toggleClass("selected");var t=this;t.operate({url:USER.allAjaxUrl.shippingAddressSetDefaultUrl,data:{address_id:e(r).data("address-id"),is_default:!a}}).done(function(e){0==e.status&&USER.otherGlobal.layerAlertReload("修改成功","/m-users-a-user_address.htm")})},operate:function(a){a=e.extend({},{type:"GET"},a);var t=USER.userAjax.getAjaxPromise(a,!0);return t.fail(function(){layer.alert("操作失败，点击确定重试",function(){r.location.reload(!0)})}),t},verifiedForm:function(){var r=this;e(".js_verifiedBtn").on("click",function(){2==e("#verified-form").find(".js_remove").length?r.operate({url:USER.allAjaxUrl.shippingAddressVerifiedUrl,data:e("#"+r.verifiedFormId).serialize()}).done(function(e){0==e.status&&USER.otherGlobal.layerAlertReload("认证成功")}):e("#verified-form").find(".error").html('<span class="form-error" style="display: inline;">请先上传身份证正反面2张照片</span>').show()})}},profile:{profileFormObj:"",changePassFormObj:"",profileValidate:function(){e.validator.setDefaults({debug:!1,success:"valid",ignore:""}),this.profileFormObj.validate({errorClass:"form-error",wrapper:"p",success:function(e){e.remove()},errorPlacement:function(e,r){r.parent().parent().find(".error").remove(),e.addClass("error").appendTo(r.parent().parent())},rules:{nickname:{rangelength:[2,25]},email:{email:!0}},messages:{nickname:{rangelength:e.validator.format("昵称长度在 {0} 和 {1} 之间")},email:{email:"请输入正确的邮箱地址"}}})},profileForm:function(r){var t=this;t.profileFormObj=r,r.find(".js_selected").on("click",function(r){r.preventDefault(),e(this).toggleClass("selected");var a=e(this).find("input").eq(0)[0];a.checked=!a.checked}),a.script("jquery.validate.min.js").script("laydate/laydate.dev.js").wait(function(){t.profileValidate(),t.profileFormObj.find("#js_birthday").focus(function(){laydate({elem:"#js_birthday",start:"1990-1-1 00:00:00",max:laydate.now()})}),e(".js_submit").on("click",function(e){e.preventDefault(),t.profileFormObj.valid()&&t.profileFormObj[0].submit()})})},changePassValidate:function(){USER.otherGlobal.getMyValidate(this.changePassFormObj,{rules:{current_password:{required:!0,rangelength:[6,16]},password:{required:!0,rangelength:[6,16],notEqualTo:"#js_currentPass"},password_confirm:{required:!0,rangelength:[6,16],equalTo:e("#js_password")},security_code:{required:!0}},messages:{current_password:{required:"请输入当前密码",rangelength:e.validator.format("密码长度在 {0} 到 {1} 个字符之间")},password:{required:"请输入新密码",rangelength:e.validator.format("密码长度在 {0} 到 {1} 个字符之间"),notEqualTo:"请设置不同的密码"},password_confirm:{required:"请确认密码",rangelength:e.validator.format("密码长度在 {0} 到 {1} 个字符之间"),equalTo:"请确认两次输入密码相同"},security_code:{required:"请输入验证码"}}})},changePassEvent:function(){this.changePassFormObj.find(".js_refresh").click(function(){var e=document.getElementById("img-verifycode");e.src=e.getAttribute("data-src")+"&"+(new Date).getTime()})},changePassForm:function(r){var t=this;t.changePassFormObj=r,t.changePassEvent(),a.script("jquery.validate.min.js").wait(function(){t.changePassValidate(),e(".js_submit").on("click",function(e){e.preventDefault(),t.changePassFormObj.valid()&&USER.userAjax.getAjaxPromise({url:USER.allAjaxUrl.changePasswordUrl,data:t.changePassFormObj.serialize()},!0).done(function(e){0==e.status&&USER.otherGlobal.openPop({area:["500px","300px"],end:function(){USER.otherGlobal.windowReload(USER.allAjaxUrl.loginUrl)}})}).fail(function(){USER.otherGlobal.layerAlertReload("密码修改失败，点击确定重试！")})})})}},otherGlobal:{layerIndex:"",windowReload:function(e){e=e||"",""===e?r.location.reload(!0):r.location.href=e},layerAlertReload:function(e,r){r=r||"",layer.alert(e,{end:function(){USER.otherGlobal.windowReload(r)}},function(){USER.otherGlobal.windowReload(r)})},openPop:function(r,a){var t=e("#js_pop"),n=this;if(r=e.extend({},{type:1,shadeClose:!1,title:"提示",area:["500px","350px"],content:t,end:function(){}},r),n.layerIndex=layer.open(r),a=arguments.length>1?a:!1){t=r.content;var i=t.find(".js_cancel");i.off("click"),i.on("click",function(e){e.preventDefault(),layer.close(n.layerIndex)})}},setTopStep:function(){var r=e(".js_topStepCurrent"),a=r.index();r.parent().children("span:lt("+(a+1)+")").addClass("active");var t=r.offset().left-r.siblings().eq(0).offset().left;e(".js_stepLine").width(t+2)},setCheckBox:function(){e(".js_checkbox").click(function(){var r=e(this).siblings(".js_inputCheckbox")[0];e(this).toggleClass("selected"),r.checked=!r.checked})},setValidateCnMessage:function(){e.extend(e.validator.messages,{required:"请输入评价商品",remote:"请修正该字段",email:"请输入正确格式的电子邮件",url:"请输入合法的网址",date:"请输入合法的日期",dateISO:"请输入合法的日期 (ISO).",number:"请输入合法的数字",digits:"只能输入整数",creditcard:"请输入合法的信用卡号",equalTo:"请再次输入相同的值",accept:"请输入拥有合法后缀名的字符串",maxlength:e.validator.format("请输入一个长度最多是 {0} "),minlength:e.validator.format("请输入一个长度最少是 {0} "),rangelength:e.validator.format("请输入一个长度介于 {0} 和 {1} 之间"),range:e.validator.format("请输入一个介于 {0} 和 {1} 之间的值"),max:e.validator.format("请输入一个最大为 {0} 的值"),min:e.validator.format("请输入一个最小为 {0} 的值")})},getMyValidate:function(r,a){return jQuery.validator.addMethod("notEqualTo",function(r,a,t){return this.optional(a)||r!=e(t).val()},"Each element should have a different value"),jQuery.validator.setDefaults({debug:!1,success:"valid",ignore:""}),a=e.extend({errorClass:"form-error",wrapper:"p",success:function(e){e.remove()},errorPlacement:function(e,r){r.parent().parent().find(".error").remove(),e.addClass("error").appendTo(r.parent().parent())}},a),r.validate(a)},resetForm:function(e,r){e.reset(),r.resetForm()}}},e(function(){e(".js_deleteOrder").on("click",function(r){r.preventDefault(),USER.order.remove(e(this).data("order-sn"))}),e(".js_buyAgain").on("click",function(r){r.preventDefault(),USER.order.buyAgain(e(this).data("order-sn"))}),e(".js_topStepCurrent").length>0&&USER.otherGlobal.setTopStep(),USER.otherGlobal.setCheckBox(),e(".js_syTime").each(function(){var r=e(this);USER.order.expirationTime(this,r.data("sytime"),r.data("order-sn"))}),e(".js-view-shipping").on("click",function(){USER.order.shippingView(e(this).data("order-sn"),e(this).data("shipping-name"),e(this).data("shipping-no"))}),e(".js_confirmReceipt").on("click",function(){var r=e(this).data("order-id");layer.confirm("确认收货 ？",{btn:["确认","取消"],shade:.3},function(){USER.order.confirmReceipt(r)},function(){})})})}(jQuery,window,$LAB);