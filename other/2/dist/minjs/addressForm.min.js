$.fn.setCityMenu=function(e){e=$.extend({},{ajaxUrl:"/fun/index.php?act=GetAddressList",elmProvince:".selected_province",elmCity:".selected_city",elmDistrict:".selected_district"},e);var t=$(this).find(e.elmProvince),n=$(this).find(e.elmCity),r=$(this).find(e.elmDistrict),i=function(e,t){for(var n='<option value="default">'+e.find("option:first").text()+"</option>",r=0;r<t.length;r++)n+='<option value="'+t[r].id+'">'+t[r].value+"</option>";e.html(n)},a=function(t,n){$.ajax({url:e.ajaxUrl,type:"POST",global:!1,data:{id:t},dataType:"json"}).done(function(e){0==e.status?n(e):layer.alert(e.msg,function(){window.location.reload(!0)})}).fail(function(){layer.alert("获取城市列表失败, 点击确定刷新重试",function(){window.location.reload(!0)})})};t.change(function(){var e=this.value;""===e||"default"==e?n.parent().hide():a(e,function(e){i(n,e.data.city_list),n.parent().show()}),r.parent().hide()}),n.change(function(){var e=this.value;""!=e&&"default"!=e?a(e,function(e){i(r,e.data.city_list),e.data.city_list.length<=0?r.val("default").parent().hide():r.parent().show()}):r.parent().hide()})},window.ADDRESSFORM=function(e,t){if(!(e.length<=0)){this.form=e,this.callBack=t||$.noop,this.formValidate="",this.submitBtn=this.form.find(".address_confirm_submit");var n=this;return $LAB.script("jquery.validate.min.js").wait(function(){n.init()}),this}},ADDRESSFORM.prototype={init:function(){this.validate(),this.bindSaveEvent(),this.form.find(".select_address").setCityMenu()},bindSaveEvent:function(){var e=this;this.submitBtn.on("click",function(t){t.preventDefault();var n=e.form.valid(),r=e.selectValidate();n&&r&&e.callBack.call(e.form[0])})},selectValidate:function(){$parent=$(".js_select_address"),$parent.find(".form-error").removeClass("form-error"),$parent.find("p.error").remove();var e=!0;return $parent.find(".item-select").each(function(){var t=$(this);return t.is(":visible")&&"default"==this.value?(t.addClass("form-error"),t.parent().parent().append('<p class="error"><label class="form-error" style="display: inline;">请选择</label></p>'),e=!1,!1):void 0}),e},selectChangeValidate:function(){var e=this;$(".item-select").change(function(){setTimeout(function(){e.selectValidate()},80)})},validate:function(){this.selectChangeValidate(),jQuery.validator.addMethod("mobile",function(e,t){var n=e.length,r=/^(((13[0-9]{1})|(15[0-9]{1})|(17[6-8]{1})|(14[5-7]{1})|(18[0-9]{1}))+\d{8})$/;return this.optional(t)||11==n&&r.test(e)},"手机号码格式错误"),jQuery.validator.addMethod("idnumber",function(e,t){var n=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;return this.optional(t)||n.test(e)},"身份证号码格式错误"),$.validator.setDefaults({debug:!0,success:"valid",ignore:".item-select"}),this.formValidate=this.form.validate({errorClass:"form-error",wrapper:"p",success:function(e){e.remove()},groups:{num:"areacode telephone ext"},errorPlacement:function(e,t){e.appendTo(t.parent().parent())},rules:{addressline:{required:!0,rangelength:[5,50]},username:{required:!0,rangelength:[2,15]},tel:{required:function(){return""==$("input[name=telephone]").val()},mobile:!0,rangelength:[11,11]},areacode:{required:function(){return!(""==$("input[name=telephone]").val())},digits:!0,rangelength:[3,4]},telephone:{required:function(){return!(""==$("input[name=areacode]").val())},rangelength:[7,8]},ext:{digits:!0,rangelength:[1,4]},card_id:{required:!0,idnumber:!0}},messages:{addressline:{required:"请输入详细地址",rangelength:"详细地址长度在 5 - 50 个字符",maxlength:"详细地址长度在 5 - 50 个字符"},username:{required:"请输入名字",rangelength:"姓名长度在2 - 15 个字符",maxlength:"姓名长度在2 - 15 个字符"},tel:{required:"请输入手机号码",mobile:"请输入正确的电话号码",rangelength:"请输入正确的电话号码",maxlength:"请输入正确的电话号码"},areacode:{required:"请输入区号",digits:"请输入正确的区号",rangelength:"请输入正确的区号",maxlength:"请输入正确的区号"},telephone:{rangelength:"请输入正确的电话号码",required:"请输入电话号码",maxlength:"请输入正确的电话号码"},ext:{digits:"请输入正确的分机号码",maxlength:"请输入正确的分机号码",rangelength:"请输入正确的分机号码"},card_id:{required:"请输入身份证号码",idnumber:"请输入正确的身份证号码",maxlength:"请输入正确的身份证号码"}}})},formReset:function(){$(ORDERADDRESS.addressFormId)[0].reset();var e=$(ORDERADDRESS.addressFormId).find("input[name=is_default_address]"),t=e.siblings(".icon_checkbox");e[0].checked?t.addClass("selected"):t.removeClass("selected"),$parent=$(".js_select_address"),$parent.find(".form-error").removeClass("form-error"),$parent.find("p.error").remove(),$parent.find(".nselect_wrap").not(":first").hide(),$parent.find(".selected_province")[0].value="default",this.formValidate.resetForm()}};