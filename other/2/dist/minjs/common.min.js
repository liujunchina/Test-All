window.GLOBAL={},GLOBAL.checkmail=function(e){var t=/^[\w][\.\w_-]+[\w]@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/,n=t.test(e);return n?!0:!1},GLOBAL.lazyLoad={scrollLazyLoad:function(e){var t=$(e);t.lazyload({threshold:100,effect:"fadeIn",failure_limit:60,skip_invisible:!1})}},GLOBAL.Search=function(e,t){var n,o,a=e,i=t;return n=$.trim(a.val()),n=n.replace(/\*/g,"~~"),n=n.replace(/\|/g,"]]"),n=n.replace(/\=/g,"(("),n=n.replace(/\"/g," "),n=n.replace(/\</g,"))"),n=n.replace(/\>/g,")))"),n=n.replace(/\?/g,"!!!"),n=n.replace(/\+/g,"__"),n=n.replace(/\-/g,"^^"),n=n.replace(/\//g,".."),n=n.replace(/\\/g,"..."),n=n.replace(/\%/g,"!!"),n=n.replace(/\#/g,"~~~"),n=n.replace(/\>/g,"___"),n=n.replace(/\</g,"^^^"),n=n.replace(/\"/g,"[["),n=n.replace(/\$/g,"[[["),n=n.replace(/\s+/g,"-"),n=n.toLowerCase(),n=n.replace(/\b\w+\b/g,function(e){return e}),n.length<1?a.focus():(n=n.replace("%20","-"),o=i.val(),window.location.href=DOMAIN+"/s/"+n+"/"),!1},GLOBAL.login={info_check:function(e){$.ajax({url:DOMAIN+"/fun/?act=info_check",type:"POST",dataType:"json"}).done(function(t){var n=t.firstname,o=t.cart_items,a=$(".isLogin"),i=$(".isNoLogin"),s=$("#js_topCartNum"),r=$("#js_leftCartNum"),l=$("#js_isLoginName");n?(i.hide(),a.show(),l.find("span").html(n)):(i.show(),a.hide()),o&&(s.html(o),r.html(o)),e&&"function"==typeof e&&e(t)})},isLogin:function(){$("#isNoLogin").hide(),$("#isLogin").show()}},GLOBAL.cart={cartItems:function(){},add:function(){var e=$("#js_qty"),t=Number(e.val());e.val(t+1),e.keyup()},reduce:function(){var e=$("#js_qty"),t=Number(e.val());t>1&&(e.val(t-1),e.keyup())},input_quantity:function(e){var t=$(e),n=$("#js_addCart"),o=$("#js_aAddCart"),a=$("#js_buyBtn"),i=$("#js_aBuyBtn"),s=parseInt($("#js_currentPrice").attr("value")),r=0,l=t.val(),c=$("#js_overAmountTip_1"),d=$("#js_overAmountTip_2"),u=$("#js_buyBtn"),f=$("#js_aBuyBtn");return isNaN(l)?(layer.open({btn:["ok"],content:"请输入正确的数字",end:function(){t.focus()}}),t.val(1),$(e).attr("value",1),n.attr("num",1),a.attr("num",1),!1):(r=parseInt(l)*parseInt(s),r>500&&1e3>r?(c.css("display","block"),d.css("display","none"),u.removeClass("disabled"),f.removeClass("disabled")):r>1e3?(c.css("display","none"),d.css("display","block"),u.addClass("disabled"),f.addClass("disabled")):(c.css("display","none"),d.css("display","none"),u.removeClass("disabled"),f.removeClass("disabled")),l>=999999?(t.val(999999),$(e).attr("value",999999),n.attr("num",999999),o.attr("num",999999),a.attr("num",999999),i.attr("num",999999)):l>=1&&999999>l?($(e).attr("value",l),n.attr("num",l),o.attr("num",l),a.attr("num",l),i.attr("num",l)):(t.val(1),$(e).attr("value",1),n.attr("num",1),o.attr("num",1),a.attr("num",1),i.attr("num",1)),void 0)},addcart:function(e){var t=$(e),n=t.attr("gid"),o=t.attr("num"),a=0;return t.hasClass("disabled")?!1:(t.hasClass("buyNow")&&(a=1),void $.ajax({url:"/m-flow-a-add_to_cart.html",type:"POST",dataType:"json",data:{goods_id:n,goods_num:o,express:a}}).done(function(n){var o=n.status,a=n.cart_items,i=$("#js_shopcart"),s=$("#js_topCartNum");if(0===o&&t.hasClass("buyNow"))window.location.href=DOMAIN_CART+"/m-flow-a-checkout.html";else if(0===o&&t.hasClass("addToCart")){var r=$(e),l=$(window).scrollTop(),i=$("#js_shopcart");if(window.requestAnimationFrame){var c=$('<img class="u-flyer" src="'+r.data("proimg")+'"/>');c.fly({start:{left:r.offset().left,top:r.offset().top-l},end:{left:i.offset().left,top:i.offset().top-$(window).scrollTop(),width:20,height:20},onEnd:function(){i.find(".num").text(a),s.text(a),c.remove()}})}else i.find(".num").text(a),s.text(a)}else layer.open({btn:["ok"],content:n.msg})}))},addCartAjaxFn:function(e,t){var n=e.goods_id,o=e.goods_num;$.ajax({type:"POST",url:"/m-flow-a-add_to_cart.htm",data:{goods_id:n,goods_num:o},dataType:"jsonp",success:function(e){t&&"function"==typeof t&&t(e)}})}},GLOBAL.setFLoatBoxPosition=function(){var e=$(window),t=$(".js_mainBgWrap").offset().top+46,n=$("#rightBar"),o=$("#leftBar"),a=66,i=e.width();e.scrollTop()<=t-a?(n.css({position:"absolute",top:t}).show(),i>=1440&&o.css({position:"absolute",top:t}).show()):(n.css({position:"fixed",top:a}).show(),i>=1440&&o.css({position:"fixed",top:a}).show())},GLOBAL.otherGlobal={supports:function(e){var t=document.createElement("div"),n="Khtml O Moz Webkit".split(" "),o=n.length;if(e in t.style)return!0;if("-ms-"+e in t.style)return!0;for(e=e.replace(/^[a-z]/,function(e){return e.toUpperCase()});o--;)if(n[o]+e in t.style)return!0;return!1},getTime:function(e){if(e>0){var t=e,n=Math.floor(t/60),o=Math.floor(n/60),a=o,i=n%60,s=t%60;return 10>a&&(a="0"+a),10>i&&(i="0"+i),10>s&&(s="0"+s),{hours:a,minutes:i,seconds:s}}return!1},addCookie:function(e){e=$.extend({name:"",value:"",expiresHours:72,domain:COOKIESDIAMON,path:"/"},e);var t=e.name+"="+escape(e.value)+";path="+e.path+";domain="+e.domain;if(e.expiresHours>0){var n=new Date;n.setTime(n.getTime()+3600*e.expiresHours*1e3),t=t+"; expires="+n.toGMTString()}document.cookie=t},getCookie:function(e){for(var t=document.cookie,n=t.split("; "),o=0;o<n.length;o++){var a=n[o].split("=");if(a[0]==e)return a[1]}return""},deleteCookie:function(e){var t=new Date;t.setTime(t.getTime()-1e4),document.cookie=e+"=v; expires="+t.toGMTString()}},function(e){e.fn.toTop=function(t){return t=e.extend({speed:200},t),this.each(function(){e(this).on("click",function(){e("html, body").animate({scrollTop:0},t.speed)})}),this}}(jQuery),function(e){e.fn.delayKeyup=function(t,n){var o=0;return e(this).on("keyup",function(e){clearTimeout(o),t&&"function"==typeof t?o=setTimeout(function(){t(e)},n):alert("Your callback is not valid")}),e(this)}}(jQuery),$(function(){layer.config({skin:"layer-ext-moon",extend:"skin/moon/style.css"});var e;$(document).ajaxStart(function(){e=layer.msg("努力加载中",{icon:16,scrollbar:!0,shade:[.3,"#000"],time:15e3})}).ajaxComplete(function(){setTimeout(function(){layer.close(e)},500)}),$.ajaxSetup({global:!1,timeout:1e4}),$(".js_loading").on("click",function(){layer.open({type:2,shadeClose:!1})}),GLOBAL.login.info_check(),GLOBAL.lazyLoad.scrollLazyLoad($("img[data-original]")),$("#rightBar,#leftBar").length>0&&$(".js_mainBgWrap").length>0&&($(window).scroll(function(){GLOBAL.setFLoatBoxPosition()}),GLOBAL.setFLoatBoxPosition(),$(window).resize(function(){var e=$(this),t=$("#leftBar"),n=e.width();setTimeout(function(){n>=1600?t.show():t.hide()},500)})),$("#rightBar").length>0&&$(".js_scrollToTop").click(function(){$("html,body").animate({scrollTop:0},500)})}),function(){$(".js_topSearchBtn").parent().find("input[name='keyword']").on("keydown",function(e){var t=$(this);13===e.keyCode&&t.parent().find(".js_topSearchBtn").trigger("click")}),$(".js_topSearchBtn").click(function(){var e=$(this),t=e.parent().find("input[name='keyword']"),n=e.parent().find("input[name='category']");GLOBAL.Search(t,n)}),function(){function e(){var e=a.val();e?$.ajax({type:"GET",url:DOMAIN+"/temp/skin1/dist/minjs/demo_search.json",data:{keyword:e},dataType:"json",beforeSend:function(){$("#js_seachLoading").show()},success:function(e){$("#js_seachLoading").hide(),"fail"!=e.res?(o.html(e.res),t()):n()}}):n()}function t(){o.show();var e=o.find("li"),t=e.size(),i=(a.val(),0);o.find("li").on("mouseover",function(e){e.preventDefault();var t=$(this);i=t.index()+1,t.siblings("li").find("a").removeClass("current"),t.find("a").addClass("current")}),$(document).on("keydown",function(s){if(38==s.keyCode)i--,0>=i&&(i=t);else{if(40!=s.keyCode)return 27==s.keyCode?void n():void 0;i++,i>t&&(i=1)}var r=e.eq(i-1);o.find("li").find("a").removeClass("current"),r.find("a").addClass("current"),a.val(r.find("span").text())})}function n(){var e=a.val();e||o.html(i),o.hide(),$(document).off("keydown")}var o=$("#js_seachComplete"),a=$("#js_topSearch"),i=o.html();$(document).on("click",function(){n()}),$("#js_topSearch,#js_seachComplete").on("click",function(e){e.stopPropagation(),t()}),a.delayKeyup(function(t){37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode&&116!=t.keyCode&&27!=t.keyCode&&e()},300),o.on("click","li a",function(){var e=$(this);return a.val(e.find("span").text()),n(),!1})}()}(),function(){function e(e){var n=$(e.target),o=$(window).scrollTop(),a=$("#js_shopcart");if(n.hasClass("disabled"))return!1;if(window.requestAnimationFrame){var i=$('<img class="u-flyer" src="'+n.data("proimg")+'"/>');i.fly({start:{left:n.offset().left,top:n.offset().top-o},end:{left:a.offset().left,top:a.offset().top-$(window).scrollTop(),width:20,height:20},onEnd:function(){GLOBAL.cart.addCartAjaxFn({goods_id:n.data("goods_id"),goods_num:1},t),i.remove()}})}else GLOBAL.cart.addCartAjaxFn({goods_id:n.data("goods_id"),goods_num:1},t)}function t(e){var t=e.status,n=e.cart_items;if(t)alert(e.msg);else{var o=$("#js_shopcart"),a=$("#js_topCartNum");o.find(".num").text(n),a.text(n)}}$(".js_addToCart").on("click",e);for(var n=0,o=["ms","moz","webkit","o"],a=0;a<o.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[o[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[o[a]+"CancelAnimationFrame"]||window[o[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=(new Date).getTime(),o=Math.max(0,16-(t-n)),a=window.setTimeout(function(){e(t+o)},o);return n=t+o,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();