!function(t){var e=function(t,e){this.$elm=t,this.options=e};e.prototype={init:function(){this.bindEvent(),this.$tabls=this.$elm.find(this.options.item);var t=this.$tabls.eq(this.options.startIn);return this.tabSwitch(t,!0),this},bindEvent:function(){var e=this;e.$elm.on(e.options.triggerType,e.options.item,function(s){s.preventDefault(),e.tabSwitch(t(this))})},tabSwitch:function(t){if(t.length>0){var e=this,s=t[0].hash;t.addClass(this.options.activeClass).parent().siblings().children().removeClass(this.options.activeClass);var n=this.options.container.find(s);n.show().siblings().hide(),e.options.tabInCallBack(n)}},setTab:function(t){var e;e=isNaN(t)?this.$elm.find(t):this.$tabls.eq(t),this.tabSwitch(e,!1)}},t.fn.myTab=function(s){return s=t.extend({item:"a",container:t(".tab-contents"),triggerType:"click",startIn:0,activeClass:"active",tabInCallBack:t.noop},s),this.each(function(){t(this).data("myTab",new e(t(this),s).init())})},window.Spike={spikeTab:"",getSpikeDataUrl:"/m-sales-a-index_ajax.html",spikeText:{startText:"距抢购开始",inProgressText:"距抢购结束",endText:"抢购已结束"},statusText:{startText:"即将开始",inProgressText:"秒杀进行中",endText:"已结束"},getTabContents:function(){return"undefined"==typeof this.tabContents&&(this.tabContents=t("#js_spikeTabContents").children("li")),this.tabContents},setCurrentSpike:function(t){this.currentSpike=t},getCurrentSpike:function(){return this.currentSpike},setStartText:function(e){var s=this,n=e.index();e.find(".js_text").text(s.spikeText.startText),t("#js_spikeTabs").find(".js_spikeStatus").eq(n).text(s.statusText.startText)},setInProgressText:function(e){var s=this,n=e.index();e.find(".js_text").text(s.spikeText.inProgressText),t("#js_spikeTabs").find(".js_spikeStatus").eq(n).text(s.statusText.inProgressText)},setEndText:function(e){var s=this,n=e.index();e.find(".js_text").text(s.spikeText.endText),t("#js_spikeTabs").find(".js_spikeStatus").eq(n).text(s.statusText.endText)},getLaytpl:function(t){"undefined"==typeof laytpl?$LAB.script("laytpl.min.js?2015101001").wait(function(){t()}):t()},createTable:function(){var e=t("#js_spikeTabs");e.myTab({item:"a",container:t("#js_spikeTabContents"),triggerType:"click",startIn:0,activeClass:"active",tabInCallBack:t.noop}),this.spikeTab=e.data("myTab")},renderData:function(e){var s=this;s.getLaytpl(function(){t.ajax({url:s.getSpikeDataUrl,type:"POST",dataType:"json"}).done(function(t){if(0!=t.status)return!1;var n=document.getElementById("js_spikeTpl").innerHTML;laytpl(n).render(t.data,function(t){document.getElementById("js_spikeWrap").innerHTML=t,s.createTable(),e.call(s)})})})},init:function(){var e=this;e.renderData(function(){this.getTabContents().each(function(s){var n=t(this),i=n.data("start-time"),a=n.data("end-time"),o=a-i;0==i&&0!=a&&e.spikeTab.setTab(s);var r=n.find(".js_time");GLOBAL.otherGlobal.getTime(i)?(e.setStartText(n),e.setSyTime(r,i,function(){e.setInProgressText(n),e.setSyTime(r,o,function(){e.setEndText(n),e.end(r)})})):GLOBAL.otherGlobal.getTime(a)?(e.setInProgressText(n),e.setSyTime(r,a,function(){e.setEndText(n),e.end(r)})):""===a||""===i?window.console&&console.log("第"+(s+1)+"场次参数设置异常"):(e.setEndText(n),e.end(r))})})},end:function(e){e.html('<span class="h time">00</span><span>:</span><span class="m time">00</span><span>:</span><span class="s time">00</span>');var s=e.closest(".js_spike");s.find(".spike-warp").remove(),s.addClass("ended").find("li").each(function(){var e=t(this),s=e.find(".goods-img a").attr("href");e.append('<a class="spike-end spike-warp" href="'+s+'" target="_blank">已结束<span class="spike-layer"></span></a>'),e.find(".spike-btn").html("去看看")}),this.spikeTab.setTab(s.index()+1)},setSyTime:function(t,e,s){var n=t,i=GLOBAL.otherGlobal.getTime(e);return 0==i?(s(),!1):(n.html('<span class="h time">'+i.hours+'</span><span>:</span><span class="m time">'+i.minutes+'</span><span>:</span><span class="s time">'+i.seconds+"</span>"),e--,void setTimeout(function(){Spike.setSyTime(t,e,s)},1e3))}}}(jQuery),$(function(){Spike.init()});