!function(t,e){e.CART={getDataUrl:"/m-flow-a-get_cart.html",updateGoodsNumUrl:"/m-flow-a-update_cart.html",deleteGoodsUrl:"/m-flow-a-drop_goods.html",clearCartUrl:"/m-flow-a-clear.html",updateSelectStatusUrl:"/m-flow-a-checked_cart.html",maxGoodsNum:999999,inputTimer:null,getCartAjaxPromise:function(e,a){a=arguments.length>1?a:!0;var l={type:"POST",global:!0,dataType:"json"};e=t.extend({},l,e);var s=t.ajax(e);return a&&this.ajaxSuccessCall(s),s},checkIsselectAll:function(){var e=t("#cart_form"),a=e.find(".js_select_tiem");a.length==a.filter(".selected").length?e.find(".js_select_all").addClass("selected"):e.find(".js_select_all").removeClass("selected")},init:function(){var t=this,a=this.getCartAjaxPromise({url:this.getDataUrl},!1);a.done(function(e){switch(e.status){case 0:t.render(e);break;default:t.ajaxFailCall(e)}}).fail(function(){layer.alert("获取购物车信息失败，点击确定重试",function(){e.location.reload(!0)})})},render:function(e){var a=document.getElementById("cart_tmp").innerHTML;"undefined"!=typeof e.data.cart_num&&t("#js_topCartNum").text(e.data.cart_num),laytpl(a).render(e.data,function(t){document.getElementById("cart_form").innerHTML=t}),this.checkIsselectAll()},checkGoodsNum:function(t){return parseInt(t)==t&&t>0&&t<=this.maxGoodsNum},changeEvent:function(e){var a=this,l=e.value,s=t(e).data("cart-id");clearTimeout(a.inputTimer),this.checkGoodsNum(l)?this.inputTimer=setTimeout(function(){a.changeNum(l,s)},800):e.value=t(e).data("value")},changeNum:function(t,e){this.getCartAjaxPromise({url:this.updateGoodsNumUrl,data:{cart_id:e,goods_number:t}})},remove:function(t){this.getCartAjaxPromise({url:this.deleteGoodsUrl,data:{cart_id:t}})},selectCart:function(t,e){var a={selected:e};(0==e||1==e)&&(a.cart_id=t),this.getCartAjaxPromise({url:this.updateSelectStatusUrl,data:a})},ajaxSuccessCall:function(t){var e=this;t.done(function(t){0!=t.status?e.ajaxFailCall(t):e.render(t)})},ajaxFailCall:function(t){var a=t.msg;layer.alert(a,function(){e.location.reload(!0)})}},t(function(){CART.init();var e=t("#cart_form");e.on("click",".js_update_num",function(e){e.preventDefault();var a,l=t(this).siblings(".cart_goods_num"),s=l.val()||1,r=t(this).hasClass("cart_goods_plus");if(r)a=++s>=CART.maxGoodsNum?CART.maxGoodsNum:s;else{if(1==s)return;a=--s}l.val(a);var c=l.data("cart-id");CART.changeNum(a,c)}),e.on("click",".js_cart_remove",function(e){e.preventDefault(),CART.remove(t(this).data("cart-id"))}),e.on("click",".js_select_checkbox",function(){t(this).toggleClass("selected");var a;t(this).hasClass("js_select_all")?t(this).hasClass("selected")?(e.find(".js_select_checkbox").addClass("selected"),a=2):(e.find(".js_select_checkbox").removeClass("selected"),a=3):a=t(this).hasClass("selected")?1:0,CART.selectCart(t(this).data("cart-id"),a)})})}(jQuery,window);