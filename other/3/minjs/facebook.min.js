(function(){$("#img-loginFacebook").click(facebook_signup)})();window.fbAsyncInit=function(){FB.init({appId:"1406009852948446",status:true,cookie:true,oauth:true,xfbml:true})};(function(){var e=document.createElement("script");e.type="text/javascript";e.src="https://connect.facebook.net/en_US/all.js";e.async=true;document.getElementsByTagName("head")[0].appendChild(e)})();
function faceBookLoginGoto(){var flow=$("#flow").val(),ref=$("#ref").val();if(ref!="")window.location.href=ref;else if(flow=="checkout")window.location.href=HTTPS_ORDER_DOMAIN+"/"+JS_LANG+"m-flow-a-checkout.htm";else window.location.href="/"+JS_LANG+"m-users.htm"}
function openPop(fbuid,fname,lname){$("#js_fbEMail").data("fbuid",fbuid);$("#js_fbEMail").data("fname",fname);$("#js_fbEMail").data("lname",lname);return $.layer({type:1,title:false,border:[0],area:["400px","220px"],offset:[($(window).height()-240)/2+"px","50%"],page:{dom:"#js_fbEMail"}})}function checkUser(fbuid,fname,lname){if(fbuid.length>0)$.get("/fun/?act=chk_fb_sign&fbuid="+fbuid,function(data){if(data==1)faceBookLoginGoto();else openPop(fbuid,fname,lname)})}
function facebook_signup(){FB.login(function(response){if(response.authResponse){var fbuid=response.authResponse.userID;var fbtoken=response.authResponse.accessToken;FB.api({method:"fql.query",query:"select first_name,last_name,email from user where uid="+fbuid},function(rep){var fname=rep[0].first_name;var lname=rep[0].last_name;var fbEmail=rep[0].email;dinoLoginForFB(fbuid,fbtoken,fname,lname,fbEmail,0,1)})}else return},{scope:"email"})}
function dinoLoginForFB(fbuid,fbtoken,fname,lname,fbEmail,fstats,status){if(status==1){var reg=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(reg.test(fbEmail)){var postData="FTextUserEmail="+fbEmail+"&ebID="+fbuid+"&firstname="+fname+"&lastname="+lname+"&FTextUserPwd2="+parseInt(Math.random()*1E6);postData=postData+"&ebToken="+fbtoken+"&ebStats="+fstats+"&ebUid="+fbuid+"&actions=facebookLogin";$.ajax({type:"post",url:"https://"+location.hostname+
"/fb_eb_login.php",data:postData,error:function(XMLHttpRequest,textStatus,errorThrown){},success:function(result){faceBookLoginGoto()}})}else checkUser(fbuid,fname,lname)}};