!function(){function e(e,t,a){GLOBAL.PopObj.confirm({shade:[.8,"#000",!0],area:["400","auto"],title:jsLg.message,closeBtn:[0,!1],dialog:{msg:e,btns:1,type:0,btn:[jsLg.okj],yes:function(e){t&&(arguments.length>1?t(a):t()),layer.close(e)}}})}function t(){var t=!0;return $.ajax({type:"GET",url:"/"+JS_LANG+"m-flow-a-check_ship_method.htm?shipping="+$("input[name=shipping]:checked").val(),async:!1,success:function(a){0==a?(e(jsLg.checkOut_5,function(){window.location.reload()}),t=!1):t=!0}}),t}function a(){var e=$("#Js_userWallet");return e.length&&e.prop("checked")}function n(e){var t=$("#wallet_ipt"),a=$("#js_myWallet"),n=$("#Js_userWallet"),r=($(".js_alsoNeedPayNum"),$(".paymentselect")),s=$("#wallet_text"),o=0,c=0;if(o=a.attr("orgp"),o=o-0>0?o:0,c=e,c=c-o>0?o:c,c-e>=0){if("checkbox"==n.prop("type")){var i=$('<input type="radio" class="iswallet" checked value="1" id="Js_userWallet" name="is_wallet"/>');n.remove(),t.closest("dt").prepend(i),n=i}r.prop("checked",!1)}else if("radio"==n.prop("type")){var i=$('<input type="checkbox" class="iswallet" checked value="1" id="Js_userWallet" name="is_wallet"/>');n.remove(),t.closest("dt").prepend(i),n=i}t.val(c),s.attr("orgp",c)}function r(){var e=$("#walletPriceTotal").attr("orgp"),t=$("#wallet_text").attr("orgp");e=$.isNumeric(e)?e:0,t=$.isNumeric(t)?t:0,$(".js_alsoNeedPayNum").attr("orgp",e-t),GLOBAL.currency.change_html("","#js_payMethod")}function s(){$("#Js_userWallet");$("#wallet_ipt").val(0),$("#wallet_text").attr("orgp",0),$("#wallet_pass").val(""),$("#Js_userWalletWrap").find(".walletPass").fadeOut()}function o(){var e=$("#point_money"),t=c();t=void 0==t?0:parseFloat(t),e.attr("orgp",t),$(".shipping_method").each(function(){var e=0;return $(this).prop("checked")?(e=$("#sm"+$(this).val()).attr("orgp"),$("#shipping_sub_total").attr("orgp",e),!1):void 0});var s=$("#shipping_sub_total").attr("orgp");s=void 0==s?0:parseFloat(s);var o=$(".Need_Traking_number"),i=0;o.attr("checked")&&(i=parseFloat(o.val())),$("#Tracking_number").attr("orgp",i);var l=parseFloat($("#insurance").attr("orgp")),p=parseFloat($("#items_sub_total").attr("orgp")),u=(s-t+l+p+i).toFixed(2);$("#price_total").add("#walletPriceTotal").attr("orgp",u),a()&&n(u),r(),GLOBAL.currency.change_html("")}function c(){var e,t,a=$("#point_ipt"),n=0,r=$("#point_tips"),s=parseInt($("#use_point_max").text());if("number"==typeof f){if(t=a.val(),""==$.trim(t))return r.html(""),n;t=parseInt(t),t>s&&(t=s,$("#point_ipt, #hidden-point").val(s)),n=(parseFloat(t)*g).toFixed(2),e='- <span class="my_shop_price"  orgp="'+n+'">'+n+'</span> <span class="bizhong">USD</span>',r.html(e)}return n}function i(e){e.value=e.value.replace(/[^\d]/g,"")}function l(e,t){var a=e;0!=a&&$.ajax({type:"POST",url:"/"+JS_LANG+"m-flow-a-check_gift_cart.htm",data:"card_no="+a+"&price_total="+t,success:function(e){e&&"&nbsp;"!=e&&$("#gift_card_msg").html(e)}})}function p(){try{var e=document.getElementsByName("shipping")}catch(t){return!1}for(var a=e.length,n=0;a>n;n++)if(1==e[n].checked)return!0;return!1}function u(){if(a()){var t=$("#wallet_ipt"),n=$("#price_total").attr("orgp"),r=$("#wallet_pass"),s=!0;return t.val()-n<0&&!h()?(e(jsLg.wallet.otherPayMethod,function(){}),s=!1):(r.val().length?$.ajax({url:"/m-flow-a-check_transaction_password.htm",type:"POST",async:!1,dataType:"json",data:{walletpass:r.val()},success:function(t){t.status||(e(jsLg.wallet.IncorrectPas),s=!1)}}):(e(jsLg.wallet.enterPas),s=!1),s)}return 1!=h()?(e(jsLg.checkOut_2,function(){window.location.hash="pay";try{document.getElementsByName("payment")[0].focus()}catch(e){}}),!1):!0}function d(e){var t=e,a=$("#Js_userWallet"),n=$("#Js_userWalletWrap"),r=$("#paymentlist_gift_cardWrap"),c=t.hasClass("on");if(c)t.hasClass("cart_wallet")&&"checkbox"==a.prop("type")&&(s(),t.removeClass("on"),a.prop("checked",!1),r.length?r.fadeIn():"");else{if(t.hasClass("cart_wallet"))"radio"==a.prop("type")&&$.each($(".paymentselect"),function(e,t){var a=$(t);a.closest("dl").removeClass("on"),a.prop("checked",!1)}),"checkbox"==a.prop("type")&&(r.length?r.fadeOut():""),n.find(".walletPass").fadeIn();else if(t.is("#paymentlist_gift_cardWrap")){{$("#paymentlist_gift_card")}$.each($(".paymentselect"),function(e,t){var a=$(t);a.closest("dl").removeClass("on"),a.prop("checked",!1)}),n.length&&(n.hasClass("on")&&(s(),a.prop("checked",!1),n.removeClass("on")),"checkbox"==a.prop("type")&&n.fadeOut())}else n.length&&(n.fadeIn(),"radio"==a.prop("type")&&n.hasClass("on")&&(s(),a.prop("checked",!1),n.removeClass("on")),n.hasClass("on")||(r.length?r.fadeIn():"")),$.each($(".paymentselect"),function(e,t){var a=$(t);a.closest("dl").removeClass("on"),a.prop("checked",!1)});t.addClass("on"),t.find("input.paymentselect").prop("checked",!0),t.find("input.iswallet").prop("checked",!0)}o()}function h(){try{var e=document.getElementsByName("payment")}catch(t){return!1}for(var a=e.length,n=0;a>n;n++)if(1==e[n].checked)return!0;return!1}function _(){if(1!=p())return e(jsLg.checkOut_1,function(){window.location.hash="ship";try{document.getElementsByName("shipping")[0].focus()}catch(e){}}),!1;if(1!=u())return!1;if($("#postscript").val().length>500)return e(jsLg.checkOut_3,function(){$("#postscript").focus()}),!1;if("GiftCard"==$("input[type='radio'][name='payment']:checked").val()){var a=$("#gift_card_select").val();if("0"==a)return e(jsLg.checkOut_4),!1;if("0"!=a){var n=!0,r=$("#price_total").attr("orgp");return $.ajax({type:"POST",url:"/"+JS_LANG+"m-flow-a-check_gift_cart.htm",data:"card_no="+a+"&price_total="+r,async:!1,success:function(t){t&&"&nbsp;"!=t&&(e(t),n=!1)}}),n}}return t()}var f=50,g=.02,f=parseInt(f),g=parseFloat(g);o(),$("#point_ipt").on("keyup",function(){i(this);var e=this.value;$.isNumeric(e)&&(this.value=parseInt(e)),$("#hidden-point").val(this.value),o()}),$(".shipping_method").click(function(){var e=$(this).val(),t=$("#sm"+e).attr("orgp"),a=$("#Need_Traking_number_button1"),n=$(".Need_Traking_number");switch($("#shipping_sub_total").attr("orgp",t),e){case"1":a.show(),n.attr("checked",!0);break;case"2":case"3":case"4":a.hide(),n.attr("checked",!1)}o()}),$(".Need_Traking_number").click(function(){var e=$(this).data("disabled");if("disabled"==e)return $(this).prop("checked",!0),!1;{var t=$(this).attr("shipid");parseFloat($("#Need_Traking_number_fee"+t).html())}o()});var m=$(".useCoupon_help a");m.on("mouseover",function(){$("div.useCoupon_helpWrap").show()}),m.on("mouseout",function(){$("div.useCoupon_helpWrap").hide()}),$("#js_payMethod").on("click","dl",function(){d($(this))}).on("click","#wallet_pass",function(){var e=$("#Js_userWallet");return e.length&&e.prop("checked")?!1:void 0}),a()&&$("input.paymentselect").each(function(){$(this).prop("checked",!1)});var v=$("#baofei").attr("orgp");$(".baofei").click(function(){"checked"==$(this).attr("checked")?$("#insurance").attr("orgp",v):$("#insurance").attr("orgp",0),o()}),$("#gift_card_select").on("change",function(){$("#gift_card_msg").html(""),l(this.value,$("#price_total").attr("orgp"))}),$("#theForm").submit(function(){return $("#js_upFormBtn").prop("disabled",!0).addClass("uping"),_()?!0:($("#js_upFormBtn").prop("disabled",!1).removeClass("uping"),!1)})}(),function(){$("dl.helpTage").hover(function(){$(this).find("dd").fadeIn()},function(){$(this).find("dd").hide()}),$(".payMethod").on("mouseenter",".help",function(){var e=$(this),t=e.data("_bland");t&&(clearTimeout(t),e.data("_bland",0)),e.find(".helpTips").stop().show(),e.find(".triangle").show(),e.closest("dl").css("zIndex",3)}),$(".payMethod").on("mouseleave",".help",function(){var e=$(this),t=setTimeout(function(){e.find(".helpTips").hide(),e.find(".triangle").hide(),e.closest("dl").css("zIndex",1)},500);e.data("_bland",t)}),$("#js_blockSH").on("click",function(){$(this).toggleClass("orderReviewUp"),$("#js_orderReview").toggle()})}();