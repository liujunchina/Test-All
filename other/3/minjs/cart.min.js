!function(){function list_load(pageUrl,$tobj,$tobjL,popIndex){var msg_json="";$.ajax({type:"GET",url:pageUrl,beforeSend:function(){$tobj.html('<span style="font-size:12px; padding-right:15px">'+jsLg.addToCartPage_2+"</span>")},success:function(msg){msg_json=eval("("+msg+")"),"Deleted"==msg_json.result_msg?($tobjL.slideUp(),GLOBAL.cart.re_load("/"+JS_LANG+"m-flow-a-cart.htm","#cart_list")):"Deleted_token"==msg_json.result_msg&&($tobjL.slideUp(),GLOBAL.cart.re_load("/"+JS_LANG+"m-flow-a-cart.htm?token="+msg_json.token+"&PayerID="+msg_json.PayerID,"#cart_list")),popIndex&&layer.close(popIndex)}})}function cartConfim(t,a,o,e){GLOBAL.PopObj.confirm({shade:[.8,"#000",!0],dialog:{msg:t,yes:function(t){list_load(a,o,e,t)},no:function(t){layer.close(t)}}})}function cheackSelectPro(){var t=[];return $(".js_selectGoods").each(function(){1==this.checked&&t.push($(this).data("goods_id"))}),t}function cartAlert(t){GLOBAL.PopObj.confirm({shade:[.8,"#000",!0],area:["auto","auto"],title:jsLg.message,closeBtn:[0,!1],dialog:{msg:t,btns:1,type:0,btn:["Ok"],yes:function(t){layer.close(t)}}})}function checkcode(t){var t=$(t),a=encodeURIComponent(t.val()),o=t.attr("huance"),e=t.attr("isapply"),n=t.attr("huancode"),s=$('span[entry="all_total_price"]'),c=parseFloat(o).toFixed(2);"1"==e&&a!=n&&(s.html(c),s.attr("orgp",c),t.attr("isApply","0"),t.attr("huance","0"),cartAlert(jsLg.addToCartPage_3))}function codeApply(t){var a=$("#"+t),o=encodeURIComponent(a.val());if(0==o.length)return a.focus(),!1;if(o.length>40)return cartAlert(jsLg.addToCartPage_4),!1;$("#apply_msg").html(jsLg.addToCartPage_5),GLOBAL.cart.re_load("/"+JS_LANG+"m-flow-a-cart.htm?pcode="+o,"#cart_list")}function saveForLater(t,a){var o=a.goodId.join(",");t?$.get(a.url+"?id="+o,function(t){t&&cartAlert(jsLg.saveForLater)}):window.location.href=HTTPS_LOGIN_DOMAIN+"/"+JS_LANG+"m-users-a-sign.htm?ref="+window.location.href}var changeNumBlank=null;$("#cart_list").on("keyup","input.js_goods_number",function(){var $this=$(this),num=$this.val();if(!num)return!1;num>9999&&(num=9999,$this.val(num));var rid=void 0!=$this.data("gid")?$this.data("gid"):"",PayerID=void 0!=$this.data("payer_id")?$this.data("payer_id"):"",token=void 0!=$this.data("token")?$(this).data("token"):"",$msgBox=$("#num"+rid),msg_json="";changeNumBlank&&clearTimeout(changeNumBlank),changeNumBlank=setTimeout(function(){$.ajax({type:"POST",url:"/"+JS_LANG+"m-flow-a-update_cart.htm",data:"rid="+rid+"&goods_number="+num+"&token="+token+"&PayerID="+PayerID,beforeSend:function(){$msgBox.addClass("loading")},success:function(msg){if(msg_json=eval("("+msg+")"),"Updated"==msg_json.result_msg)$msgBox.removeClass("loading"),GLOBAL.cart.re_load("/"+JS_LANG+"m-flow-a-cart.htm","#cart_list");else if("Updated_token"==msg_json.result_msg)$msgBox.removeClass("loading"),GLOBAL.cart.re_load("/"+JS_LANG+"m-flow-a-cart.htm?token="+msg_json.token+"&PayerID="+msg_json.PayerID,"#cart_list");else{var msg=jsLg.out_of_stock.replace("#num#",/(\d)+/.exec(msg_json.result_msg)[0]);$msgBox.removeClass("loading").html(msg)}}})},800)}),$("#cart_list").on("click","span.js_cart_reduce",function(){var t=$(this).data("gid"),a=$("#goods_number_"+t),o=Number(a.val());o>1&&(a.val(o-1),a.keyup())}),$("#cart_list").on("click","span.js_cart_add",function(){var t=$(this).data("gid"),a=$("#goods_number_"+t),o=Number(a.val()),e=o+1;e>9999&&(e=9999),a.val(e),a.keyup()}),$("#cart_list").on("change","#selected_allGoods",function(){var t=this;$("input.js_selectGoods").each(function(){this.checked=t.checked?t.checked:!1})}),$("#cart_list").on("change","input.js_selectGoods",function(){var t=!0;$("input.js_selectGoods").each(function(){this.checked||(t=!1)}),$("input#selected_allGoods").get(0).checked=t}),$("#cart_list").on("click","a.js_del_action",function(){var t=$(this),a=void 0!=t.data("delatr")?t.data("delatr"):"",o=(void 0!=t.data("gid")?t.data("gid"):"",void 0!=t.data("delmsg")?t.data("delmsg"):jsLg.addToCartPage_1);""!=a&&cartConfim(o,a,t.parent(),t.parents("ul"))}),$("#cart_list").on("click","a.favorite",function(){var t=$(this),a={url:t.attr("data-src"),rebackPage:window.location.href,top:t.offset().top,left:t.offset().left,cartPage:1,carFavBtn:t};return GLOBAL.login.isLogin(GLOBAL.addTofavorite,a),!1}),$("#cart_list").on("click","#del_all_action",function(){var t=void 0!=$(this).attr("delatr")?$(this).attr("delatr"):"",a=void 0!=$(this).attr("delmsg")?$(this).attr("delmsg"):jsLg.addToCartPage_1,o=cheackSelectPro(),e=[];o.length>0?""!=t&&($.each(o,function(t,a){e.push("#js_cartListTr_"+a)}),t+="?id="+o.join(","),cartConfim(a,t,$(this).parent(),$(e.join(",")))):cartAlert(jsLg.addToCartPage_6)}),$("#cart_list").on("click","#add_to_save",function(){var t=cheackSelectPro(),a={goodId:t,url:$(this).attr("data-src")};return t.length>0?GLOBAL.login.isLogin(saveForLater,a):cartAlert(jsLg.addToCartPage_6),!1}),$("#cart_list").on("change","#selcountries",function(){var t=$(this).val(),a=$("#load_ajax_msg"),o=$("#shipajax");return""==t?!1:void $.ajax({type:"POST",url:"/"+JS_LANG+"m-flow-a-cart.htm?country="+t,beforeSend:function(){a.show().html(jsLg.addToCartPage_2)},success:function(t){a.hide();var e=$(t).find("#shipajax").html();o.html(e),GLOBAL.currency.change_html("",o)}})}),$("#cart_list").on("keyup","#promotion_code",function(){checkcode(this)}),$("#cart_list").on("click",".applyBtn",function(){codeApply("promotion_code")}),$(".js_tips").hover(function(){var t=$(this);GLOBAL.PopObj.tipsShow({Obj:t,msg:t.data("tips")})},function(){GLOBAL.PopObj.closeTipsShow()})}(),function(){$("#cart_list").on("click","#promotion_code",function(){1==$(this).data("coupon-event")&&$("#coupon").css("width",$("#promotion_code").width()).slideDown("fast")}),$("#cart_list").on("mouseleave","#js_couponWrap",function(){$("#coupon").hide()}),$("#cart_list").on("click","#coupon li",function(){$("#promotion_code").val($(this).data("coupon")),$("#js_couponWrap").find("a.applyBtn").trigger("click")})}();