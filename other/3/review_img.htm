<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title></title>
    <link rel="stylesheet" href="{$imgcache_url}mincss/base_min.css"/>
    <link rel="stylesheet" href="{$imgcache_url}mincss/others_min.css"/>
	{literal}
	<script>
		function onloadFun(newFun){
			var oldFun = window.onload;
			if(typeof window.onload !="function"){
				window.onload=newFun;
			}else{
				window.onload = function(){
					oldFun();
					newFun();
				}
			}
		}

		function ProImgShow(index){
            this.lb_content = document.getElementById("lb-content");
			this.contentHereImg = document.getElementById("contentHere").getElementsByTagName("img")[0];
			this.thumbImg = document.getElementById("lb-thumbnail").getElementsByTagName("img");
            this.changeBtn = document.getElementById("lb-changeBtn").getElementsByTagName("a");
			this.prevBtn = document.getElementById("lb-previous");
			this.netBtn = document.getElementById("lb-next");
			this.loadingImg = document.getElementById("loadingImg")
            this.index = index || 0;

		}
        ProImgShow.prototype={

        	ini:function(){
        		this.toggleClass(this.thumbImg[this.index]);
                this.changeImg(this.thumbImg[this.index].getAttribute("bgSrc"));
        		this.thumImgHover();
        		this.btnEvent();
        	},


            thumImgHover:function(){
                var that =this;
                for(var i=0,len=that.thumbImg.length;i<len;i++){
                    that.thumbImg[i].index = i;
                    that.thumbImg[i].onmouseover = function(){
                        var imgSrc = this.getAttribute("bgSrc");
                        that.changeImg(imgSrc);
                        //that.contentHereImg.src=imgSrc;
                        that.toggleClass(this);
                        that.index = this.index;
                    }
                }
            },

            toggleClass:function(elemtObj){
                for(var j= 0,len=this.thumbImg.length;j<len;j++){
                    this.thumbImg[j].parentNode.className="";
                }
                elemtObj.parentNode.className="hover";
            },

            scrollImg:function(direction){
                if(direction == "left"){
                    this.index--;
                    this.index<0?this.index=this.thumbImg.length-1:"";
                }else if(direction == "right"){
                    this.index++;
                    this.index>this.thumbImg.length-1?this.index=0:"";
                }
                this.changeImg(this.thumbImg[this.index].getAttribute("bgSrc"));
                
            },

            changeImg:function(src){
            	var img = new Image();
            	var that = this;

            	that.loadingImg.style.display = "block";
            	img.onload = function(){
            		that.contentHereImg.src = this.src;
            		that.loadingImg.style.display = "none";
            	}

            	img.src = src;
            },

            btnEvent:function(){
                var that = this;

                for(var i=0,len=that.changeBtn.length;i<len;i++){
                    that.changeBtn[i].onclick=function(){
                        if(this.id=="lb-previous"){
                            that.scrollImg("left");
                        }else if(this.id=="lb-next"){
                            that.scrollImg("right");
                        }
                        that.toggleClass(that.thumbImg[that.index]);
                    }
                }

               this.lb_content.onmouseover = function(){

                    for (var j = that.changeBtn.length - 1; j >= 0; j--) {
                        that.changeBtn[j].style.display = "block";
                    };
                }

               this.lb_content.onmouseleave = function(){
                       
                    for (var j = that.changeBtn.length - 1; j >= 0; j--) {
                        that.changeBtn[j].style.display = "none";
                    };  
                }

                
            }
        };

		function ini(){
            //获取页面地址上index的数字，表示是第几张图片
            // var windowUrl = location.search.substr(1).split("&");
            // var arryIndex = windowUrl[windowUrl.length-1].split("=");
            // var index = arryIndex[arryIndex.length-1];
            var windowUrl = location.search.substr(1);
            var star = windowUrl.indexOf("index=")+"index=".length;
            var end = windowUrl.indexOf("&",star);
            var index = end > -1 ? windowUrl.substring(star,end) :  windowUrl.substring(star);
            
            //定义一个PromImgShow对象
            var ProImgShowFun = new ProImgShow(index);
            ProImgShowFun.ini();
        }

        onloadFun(ini);
	</script>
		{/literal}
</head>
<body>
<div id="lb-contentWarp" style="background:#fff;">
		<div id="lb-content">
			<div id="contentHere">
				<img src=""/>
			</div>
			
			<div class="contentBtn" id="lb-changeBtn">
				<a href="javascript:void(0)" id="lb-previous">pre_arrow</a>
				<a href="javascript:void(0)" id="lb-next">pre_arrow</a>
			</div>
			
			<div class="loadingImg" id="loadingImg"></div>
		</div>
		
		<div id="lb-thumbnail">
			<ul>
            {foreach from=$review_img item=pic}
				<li><img width="50"  bgSrc="{$DOMAIN_IMG}/{$pic.paths}"  src="{$DOMAIN_IMG}/{$pic.thumb_paths}" /></li>
			{/foreach}	 
            </ul>
		</div>
</div>
</body>
</html>